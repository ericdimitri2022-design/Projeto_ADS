<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Aguarde um momento...</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script>window.adBlockerActive = true;</script>
  <script src="{{ url_for('static', filename='advert.js') }}"></script>
</head>
<body>
  
  <div class="adblock-modal-overlay" id="adblock-modal">
      <div class="adblock-modal-content">
          <div class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M15.936 2.5L21.5 8.064V15.936L15.936 21.5H8.064L2.5 15.936V8.064L8.064 2.5H15.936ZM15 17H9V19H15V17ZM15 5H9V15H15V5Z"></path></svg>
          </div>
          <h2>AdBlocker Detectado!</h2>
          <p>Para continuar e liberar seu link, por favor, desative seu bloqueador de anúncios e atualize a página.</p>
          <a class="adblock-refresh-button" onclick="location.reload()">Atualizar Página</a>
      </div>
  </div>

  <div class="banner-fixo" id="banner-fixo-ads">
      <script type="text/javascript">
          atOptions = { 'key' : '5aed398ecdebf38696b5a0131d685b5b', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/5aed398ecdebf38696b5a0131d685b5b/invoke.js"></script>
  </div>

  <div class="card">
    <h1 id="titulo">Preparando seu link...</h1>
    <p id="subtexto">Enquanto isso, leia uma notícia:</p>
    <div id="circle" class="circle" style="--progress:0">15</div>
    
    <div id="area-conteudo" class="conteudo-card" style="display: none;">
        <h3 id="conteudo-titulo">Carregando notícia...</h3>
        <p id="conteudo-texto"></p>
        <small id="conteudo-fonte"></small>
    </div>

    <button id="botao" class="btn">CONTINUAR PARA O DOWNLOAD</button>
    
    <div class="banner-native">
      <script async="async" data-cfasync="false" src="//pl27806509.effectivegatecpm.com/fc9e45b5ad616584db5c86a8934458a0/invoke.js"></script>
      <div id="container-fc9e45b5ad616584db5c86a8934458a0"></div>
    </div>
    
    <footer>© 2025 EricDfpXproads. Todos os direitos reservados.</footer>
  </div>

  <script type='text/javascript' src='//pl27806574.effectivegatecpm.com/5c/d9/9e/5cd99e5c3ffff1cc40d62cb9be9886f7.js'></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const bannerFixo = document.getElementById('banner-fixo-ads');
        
        setTimeout(() => {
            const containerEscondido = bannerFixo.offsetHeight < 10;
            const scriptBloqueado = window.adBlockerActive;
            const containerVazio = !bannerFixo.querySelector('iframe') && !bannerFixo.querySelector('ins');

            if (containerEscondido || scriptBloqueado || containerVazio) {
                console.log("AdBlocker DETECTADO!", {containerEscondido, scriptBloqueado, containerVazio});
                document.getElementById('adblock-modal').style.display = 'flex';
            } else {
                console.log("AdBlocker não detectado.");
            }
        }, 1500);

        // --- Suas chaves de API ---
        const NEWS_API_KEY = '76f6c27aa4214115aa6a9e9552c5e27f';
        const GNEWS_API_KEY = 'c9cf618948f565395e7dadae66637268';

        // --- Nossos "Trabalhadores" de notícias ---
        const fetchFromNewsAPI = async () => { const url = `https://newsapi.org/v2/top-headlines?country=br&pageSize=10&apiKey=${NEWS_API_KEY}`; const response = await fetch(url); if (!response.ok) throw new Error(`NewsAPI falhou com status: ${response.status}`); const data = await response.json(); const article = data.articles[Math.floor(Math.random() * data.articles.length)]; return { title: article.title, description: article.description || "Clique para ler a matéria completa.", source: `Fonte: ${article.source.name}`, url: article.url }; };
        const fetchFromGNews = async () => { const url = `https://gnews.io/api/v4/top-headlines?country=br&lang=pt&max=10&apikey=${GNEWS_API_KEY}`; const response = await fetch(url); if (!response.ok) throw new Error(`GNews falhou com status: ${response.status}`); const data = await response.json(); const article = data.articles[Math.floor(Math.random() * data.articles.length)]; return { title: article.title, description: article.description || "Clique para ler a matéria completa.", source: `Fonte: ${article.source.name}`, url: article.url }; };
        const fetchFromG1RSS = async () => { const rssUrl = 'https://g1.globo.com/rss/g1/'; const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`; const response = await fetch(apiUrl); if (!response.ok) throw new Error("RSS2JSON (G1) falhou"); const data = await response.json(); const item = data.items[Math.floor(Math.random() * data.items.length)]; return { title: item.title, description: item.description.replace(/<[^>]*>?/gm, '').substring(0, 200) + '...', source: "Fonte: G1 (via RSS)", url: item.link }; };
        
        // --- O "Gerente" Inteligente (versão corrigida, sem duplicatas) ---
        const carregarNoticias = async () => {
            let sources = [fetchFromNewsAPI, fetchFromGNews, fetchFromG1RSS];
            sources.sort(() => Math.random() - 0.5);
            for (const fetchFunction of sources) {
                try {
                    const noticia = await fetchFunction();
                    document.getElementById('conteudo-titulo').textContent = noticia.title;
                    document.getElementById('conteudo-texto').textContent = noticia.description;
                    document.getElementById('conteudo-fonte').textContent = noticia.source;
                    const areaConteudo = document.getElementById('area-conteudo');
                    areaConteudo.style.display = 'block';
                    areaConteudo.style.cursor = 'pointer';
                    areaConteudo.onclick = () => { window.open(noticia.url, '_blank'); };
                    return;
                } catch (error) {
                    console.error(`Falha ao buscar de uma fonte: ${error.message}`);
                }
            }
            console.error("Todas as fontes de notícias falharam.");
        };
        
        carregarNoticias();

        // --- Lógica do contador ---
        const circle = document.getElementById("circle");
        const botao = document.getElementById("botao");
        const titulo = document.getElementById("titulo");
        const subtexto = document.getElementById("subtexto");
        const urlParams = new URLSearchParams(window.location.search);
        const destino = urlParams.get('destino');
        let contador = 15;
        const intervalo = setInterval(() => {
          contador--;
          const progresso = (100 - (contador * (100 / 15)));
          circle.style.setProperty("--progress", progresso);
          circle.textContent = contador;
          if (contador <= 0) {
            clearInterval(intervalo);
            circle.style.display = "none";
            document.getElementById('area-conteudo').style.display = 'none';
            botao.classList.add("show");
            titulo.textContent = "Seu link está pronto!";
            subtexto.textContent = "Clique abaixo para continuar.";
          }
        }, 1000);
        botao.addEventListener("click", () => {
          if (destino) { window.location.href = `/bonus?destino=${encodeURIComponent(destino)}`; } 
          else { window.location.href = "/bonus"; }
        });
    });
  </script>
</body>
</html>
